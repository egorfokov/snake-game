<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background-color: #222;
  color: #fff;
}

canvas {
  background-color: #000;
  display: block;
  margin: 20px auto;
  border: 4px solid #fff; /* белая рамка */
}

input, button {
  padding: 5px 10px;
  font-size: 16px;
  margin: 5px;
  border-radius: 5px;
  border: none;
}
</style>
</head>
<body>
<h1>Snake Game</h1>
<input type="text" id="nickname" placeholder="Введите имя">
<div id="score">Счёт: 0</div>
<canvas id="gameCanvas" width="400" height="400"></canvas>
<h3>Лучший рекорд: <span id="highscore">0</span></h3>
<button id="startBtn">Старт</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const scoreEl = document.getElementById('score');
const highscoreEl = document.getElementById('highscore');

let grid = 20;
let snake = [{x: 160, y: 160}];
let dx = grid;
let dy = 0;
let apple = {x: 0, y: 0};
let score = 0;
let highscore = localStorage.getItem('highscore') || 0;
highscoreEl.textContent = highscore;

let speed = 8; // начальная медленная скорость
let count = 0;

function resetApple() {
  apple.x = Math.floor(Math.random() * (canvas.width / grid)) * grid;
  apple.y = Math.floor(Math.random() * (canvas.height / grid)) * grid;
}

function gameLoop() {
  requestAnimationFrame(gameLoop);

  if (++count < speed) return;
  count = 0;

  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Белая рамка
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 4;
  ctx.strokeRect(0, 0, canvas.width, canvas.height);

  // Двигаем змейку
  let head = {x: snake[0].x + dx, y: snake[0].y + dy};
  snake.unshift(head);

  // Съедание яблока
  if (head.x === apple.x && head.y === apple.y) {
    score++;
    scoreEl.textContent = "Счёт: " + score;
    resetApple();

    if (score % 5 === 0 && speed > 1) speed--; // ускорение каждые 5 яблок
  } else {
    snake.pop();
  }

  // Столкновение с границами (обход стены)
  if (head.x < 0) head.x = canvas.width - grid;
  if (head.x >= canvas.width) head.x = 0;
  if (head.y < 0) head.y = canvas.height - grid;
  if (head.y >= canvas.height) head.y = 0;

  // Проверка столкновения с самой змейкой
  if (snake.slice(1).some(s => s.x === head.x && s.y === head.y)) {
    alert(`Game Over! Счёт: ${score}`);
    if (score > highscore) {
      highscore = score;
      localStorage.setItem('highscore', highscore);
      highscoreEl.textContent = highscore;
    }
    score = 0;
    scoreEl.textContent = "Счёт: 0";
    snake = [{x: 160, y: 160}];
    dx = grid; dy = 0;
    speed = 8; // сброс скорости
    resetApple();
  }

  // Рисуем яблоко
  ctx.fillStyle = 'red';
  ctx.fillRect(apple.x, apple.y, grid - 2, grid - 2);

  // Рисуем змейку
  ctx.fillStyle = 'lime';
  snake.forEach(s => ctx.fillRect(s.x, s.y, grid - 2, grid - 2));
}

// Управление стрелками
document.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft' && dx === 0) { dx = -grid; dy = 0; }
  if (e.key === 'ArrowUp' && dy === 0) { dx = 0; dy = -grid; }
  if (e.key === 'ArrowRight' && dx === 0) { dx = grid; dy = 0; }
  if (e.key === 'ArrowDown' && dy === 0) { dx = 0; dy = grid; }
});

let gameStarted = false;

// Старт игры по Enter или пробелу
document.addEventListener('keydown', e => {
  if (!gameStarted && (e.key === 'Enter' || e.key === ' ')) {
    snake = [{x: 160, y: 160}];
    dx = grid;
    dy = 0;
    score = 0;
    scoreEl.textContent = "Счёт: 0";
    speed = 8; // начальная скорость
    resetApple();
    gameLoop();
    gameStarted = true;
  }

  // Управление стрелками
  if (gameStarted) {
    if (e.key === 'ArrowLeft' && dx === 0) { dx = -grid; dy = 0; }
    if (e.key === 'ArrowUp' && dy === 0) { dx = 0; dy = -grid; }
    if (e.key === 'ArrowRight' && dx === 0) { dx = grid; dy = 0; }
    if (e.key === 'ArrowDown' && dy === 0) { dx = 0; dy = grid; }
  }
});

// Кнопка Старт больше не нужна для запуска игры (можно убрать или оставить для подсказки)
startBtn.addEventListener('click', () => {
  alert("Нажмите Enter или пробел, чтобы начать игру!");
});

// Инициализация яблока
resetApple();
</script>
</body>
</html>
